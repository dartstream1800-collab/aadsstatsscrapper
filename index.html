<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atlantic Amateur Dart Series - Stats Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .navigation {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            backdrop-filter: blur(10px);
        }

        .nav-button:hover, .nav-button.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scraping-section {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-align: center;
        }

        .scraping-section h2 {
            margin-bottom: 20px;
        }

        .url-input {
            display: flex;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto 20px;
        }

        .url-input input {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
        }

        .url-input button {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .url-input button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .status-error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.5);
        }

        .status-loading {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
        }

        .event-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .event-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .event-card h3 {
            margin-bottom: 10px;
        }

        .event-card .event-meta {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .stats-table th, .stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .stats-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .stats-table tr:hover {
            background: #f5f5f5;
        }

        .player-profile {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .player-name {
            font-size: 1.8rem;
            color: #667eea;
            font-weight: bold;
        }

        .player-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .search-input {
            max-width: 400px;
            margin: 0 auto 20px;
            position: relative;
        }

        .search-input input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
        }

        .search-input .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #999;
        }

        .series-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .summary-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .summary-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .url-input {
                flex-direction: column;
            }
            
            .navigation {
                justify-content: stretch;
            }
            
            .nav-button {
                flex: 1;
                text-align: center;
            }

            .player-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Atlantic Amateur Dart Series</h1>
            <p>Event-Based Stats Tracking & Player Profiles</p>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-button active" onclick="showSection('scrape')">üìä Scrape Event</button>
            <button class="nav-button" onclick="showSection('events')">üéØ Events</button>
            <button class="nav-button" onclick="showSection('overall')">üèÜ Overall Leaderboard</button>
            <button class="nav-button" onclick="showSection('qualified')">‚ú® Championship</button>
            <button class="nav-button" onclick="showSection('search')">üîç Player Search</button>
            <button class="nav-button" onclick="showSection('series')">üìà Series Summary</button>
        </div>

        <!-- Scrape Event Section -->
        <div id="scrape" class="content-section scraping-section active">
            <h2>üìä Scrape New Event Data</h2>
            <p style="margin-bottom: 20px;">Enter a DartConnect event URL to automatically extract all match data and player statistics</p>
            
            <div class="url-input">
                <input type="text" 
                       id="eventUrl" 
                       placeholder="https://tv.dartconnect.com/event/..."
                       value="">
                <button onclick="scrapeEvent()">üöÄ Scrape Event</button>
            </div>
            
            <div id="scrapeStatus" class="status-message" style="display: none;"></div>
        </div>

        <!-- Events Section -->
        <div id="events" class="content-section">
            <h2>üéØ AADS Event Series</h2>
            <p style="margin-bottom: 20px;">Individual event statistics and player performances</p>
            <div id="eventsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading events...</p>
                </div>
            </div>
        </div>

        <!-- Overall Leaderboard Section -->
        <div id="overall" class="content-section">
            <h2>üèÜ Overall Series Leaderboard</h2>
            <p style="margin-bottom: 20px;">Combined statistics across all events in the series</p>
            <div id="overallContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading leaderboard...</p>
                </div>
            </div>
        </div>

        <!-- Championship Section -->
        <div id="qualified" class="content-section">
            <h2>‚ú® Championship Qualified Players</h2>
            <p style="margin-bottom: 20px;">Players who have qualified for the Tournament of Champions</p>
            <div id="qualifiedContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading qualified players...</p>
                </div>
            </div>
        </div>

        <!-- Player Search Section -->
        <div id="search" class="content-section">
            <h2>üîç Player Profile Search</h2>
            <p style="margin-bottom: 20px;">Search for individual player profiles and event-specific statistics</p>
            
            <div class="search-input">
                <input type="text" 
                       id="playerSearch" 
                       placeholder="Enter player name..." 
                       onkeyup="searchPlayers(event)">
                <span class="search-icon">üîç</span>
            </div>
            
            <div id="searchResults">
                <div class="empty-state">
                    <h3>Enter a player name to view their profile</h3>
                    <p>See event-specific performance and overall series statistics</p>
                </div>
            </div>
        </div>

        <!-- Series Summary Section -->
        <div id="series" class="content-section">
            <h2>üìà Series Summary & Progress</h2>
            <p style="margin-bottom: 20px;">Overview of the entire Atlantic Amateur Dart Series</p>
            <div id="seriesContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading series data...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'https://kswwbqumgsdissnwuiab.supabase.co/functions/v1/aads-api-v2';

        // Current state
        let currentEvents = [];
        let currentPlayers = [];

        // Show specific section
        function showSection(sectionId) {
            // Update navigation
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');

            // Load data for section
            switch(sectionId) {
                case 'events':
                    loadEvents();
                    break;
                case 'overall':
                    loadOverallLeaderboard();
                    break;
                case 'qualified':
                    loadQualifiedPlayers();
                    break;
                case 'series':
                    loadSeriesSummary();
                    break;
            }
        }

        // Scrape event data
        async function scrapeEvent() {
            const url = document.getElementById('eventUrl').value.trim();
            const statusDiv = document.getElementById('scrapeStatus');

            if (!url) {
                showStatus('Please enter an event URL', 'error');
                return;
            }

            if (!url.includes('dartconnect.com')) {
                showStatus('Please enter a valid DartConnect event URL', 'error');
                return;
            }

            showStatus('üöÄ Starting event scrape...', 'loading');

            try {
                const response = await fetch('https://kswwbqumgsdissnwuiab.supabase.co/functions/v1/scrape-event', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ eventUrl: url })
                });

                const result = await response.json();

                if (response.ok) {
                    showStatus(
                        `‚úÖ Event scraped successfully!<br>` +
                        `üìä ${result.matchesFound} matches found<br>` +
                        `‚ú® ${result.matchesScraped} matches processed<br>` +
                        `üéØ Event: ${result.eventName || 'Unknown Event'}`,
                        'success'
                    );
                    
                    // Clear URL and refresh data
                    document.getElementById('eventUrl').value = '';
                    
                    // Refresh events list if on events tab
                    if (document.getElementById('events').classList.contains('active')) {
                        setTimeout(loadEvents, 1000);
                    }
                } else {
                    showStatus(`‚ùå Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Scrape error:', error);
                showStatus(`‚ùå Network error: ${error.message}`, 'error');
            }
        }

        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('scrapeStatus');
            statusDiv.innerHTML = message;
            statusDiv.className = `status-message status-${type}`;
            statusDiv.style.display = 'block';

            if (type !== 'loading') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Load events list
        async function loadEvents() {
            const container = document.getElementById('eventsContainer');
            
            try {
                const response = await fetch(`${API_BASE}/events`);
                const data = await response.json();

                if (data.events && data.events.length > 0) {
                    currentEvents = data.events;
                    renderEvents(data.events);
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No events found</h3>
                            <p>Start by scraping your first event data!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading events:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading events</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Render events grid
        function renderEvents(events) {
            const container = document.getElementById('eventsContainer');
            
            const eventsHtml = `
                <div class="event-grid">
                    ${events.map(event => `
                        <div class="event-card" onclick="viewEventStats(${event.id}, '${event.name}')">
                            <h3>${event.name}</h3>
                            <div class="event-meta">
                                <p>üìÖ ${new Date(event.date).toLocaleDateString()}</p>
                                <p>üéØ Event #${event.event_number}</p>
                                <p>üìä Status: ${event.status}</p>
                                ${event.total_matches ? `<p>üèÅ ${event.total_matches} matches</p>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = eventsHtml;
        }

        // View event-specific stats
        async function viewEventStats(eventId, eventName) {
            const container = document.getElementById('eventsContainer');
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading event statistics...</p>
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE}/event-stats?event_id=${eventId}`);
                const data = await response.json();

                if (data.player_stats) {
                    renderEventStats(data);
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No statistics found for this event</h3>
                            <button onclick="loadEvents()" class="nav-button">‚Üê Back to Events</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading event stats:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading event statistics</h3>
                        <button onclick="loadEvents()" class="nav-button">‚Üê Back to Events</button>
                    </div>
                `;
            }
        }

        // Render event statistics
        function renderEventStats(data) {
            const container = document.getElementById('eventsContainer');
            
            const statsHtml = `
                <div style="margin-bottom: 20px;">
                    <button onclick="loadEvents()" class="nav-button">‚Üê Back to Events</button>
                </div>
                
                <div class="player-profile">
                    <div class="player-header">
                        <div class="player-name">${data.event.name}</div>
                        <div>
                            <p>üìÖ ${new Date(data.event.date).toLocaleDateString()}</p>
                            <p>üéØ Event #${data.event.event_number}</p>
                        </div>
                    </div>
                </div>

                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Average</th>
                            <th>Legs</th>
                            <th>180s</th>
                            <th>140+</th>
                            <th>100+</th>
                            <th>High Finish</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.player_stats.map((player, index) => `
                            <tr onclick="searchPlayerByName('${player.name}')">
                                <td>${index + 1}</td>
                                <td><strong>${player.name}</strong></td>
                                <td>${player.event_average || 'N/A'}</td>
                                <td>${player.event_legs || 0}</td>
                                <td>${player.event_180s || 0}</td>
                                <td>${player.event_140_plus || 0}</td>
                                <td>${player.event_100_plus || 0}</td>
                                <td>${player.event_highest_finish || 'N/A'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = statsHtml;
        }

        // Load overall leaderboard
        async function loadOverallLeaderboard() {
            const container = document.getElementById('overallContainer');
            
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const data = await response.json();

                if (data.players && data.players.length > 0) {
                    renderLeaderboard(data.players);
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No player statistics found</h3>
                            <p>Start by scraping some event data!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading leaderboard</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Render leaderboard table
        function renderLeaderboard(players) {
            const container = document.getElementById('overallContainer');
            
            const leaderboardHtml = `
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Overall Avg</th>
                            <th>Events</th>
                            <th>Total Legs</th>
                            <th>180s</th>
                            <th>140+</th>
                            <th>High Finish</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${players.map((player, index) => `
                            <tr onclick="searchPlayerByName('${player.name}')">
                                <td><strong>${index + 1}</strong></td>
                                <td><strong>${player.name}</strong></td>
                                <td>${player.total_average || 'N/A'}</td>
                                <td>${player.events_played || 0}</td>
                                <td>${player.total_legs || 0}</td>
                                <td>${player.total_180s || 0}</td>
                                <td>${player.total_140_plus || 0}</td>
                                <td>${player.highest_finish || 'N/A'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = leaderboardHtml;
        }

        // Load qualified players
        async function loadQualifiedPlayers() {
            const container = document.getElementById('qualifiedContainer');
            
            try {
                const response = await fetch(`${API_BASE}/qualified`);
                const data = await response.json();

                if (data.qualified_players && data.qualified_players.length > 0) {
                    renderQualifiedPlayers(data.qualified_players);
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No qualified players yet</h3>
                            <p>Championship qualification will be determined based on series performance</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading qualified players:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading qualification data</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Render qualified players
        function renderQualifiedPlayers(players) {
            const container = document.getElementById('qualifiedContainer');
            
            const qualifiedHtml = `
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Qualification Rank</th>
                            <th>Player</th>
                            <th>Average</th>
                            <th>Events Played</th>
                            <th>Qualification Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${players.map(player => `
                            <tr onclick="searchPlayerByName('${player.name}')">
                                <td><strong>${player.rank}</strong></td>
                                <td><strong>${player.name}</strong></td>
                                <td>${player.total_average || 'N/A'}</td>
                                <td>${player.events_played || 0}</td>
                                <td><span style="color: green;">‚úÖ Qualified</span></td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = qualifiedHtml;
        }

        // Search players
        function searchPlayers(event) {
            if (event.key === 'Enter') {
                const playerName = event.target.value.trim();
                if (playerName) {
                    searchPlayerByName(playerName);
                }
            }
        }

        // Search for specific player
        async function searchPlayerByName(playerName) {
            const container = document.getElementById('searchResults');
            
            // Switch to search tab if not already there
            if (!document.getElementById('search').classList.contains('active')) {
                showSection('search');
            }
            
            // Update search input
            document.getElementById('playerSearch').value = playerName;
            
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading player profile...</p>
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE}/player-profile?player_name=${encodeURIComponent(playerName)}`);
                const data = await response.json();

                if (response.ok && data.player) {
                    renderPlayerProfile(data);
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>Player "${playerName}" not found</h3>
                            <p>Make sure the name is spelled correctly or try searching for a different player</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error searching player:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error searching for player</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Render player profile
        function renderPlayerProfile(data) {
            const container = document.getElementById('searchResults');
            
            const profileHtml = `
                <div class="player-profile">
                    <div class="player-header">
                        <div class="player-name">${data.player.name}</div>
                        <div style="text-align: right;">
                            <p>üìä Overall Series Stats</p>
                            <p>üéØ ${data.events_participated} Events Participated</p>
                        </div>
                    </div>

                    <div class="player-stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${data.player.total_average || 'N/A'}</div>
                            <div class="stat-label">Overall Average</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.player.total_legs || 0}</div>
                            <div class="stat-label">Total Legs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.player.total_180s || 0}</div>
                            <div class="stat-label">Total 180s</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.player.highest_finish || 'N/A'}</div>
                            <div class="stat-label">Highest Finish</div>
                        </div>
                    </div>
                </div>

                ${data.event_performances && data.event_performances.length > 0 ? `
                    <h3 style="margin: 20px 0;">üìà Event-by-Event Performance</h3>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>Event</th>
                                <th>Date</th>
                                <th>Event Avg</th>
                                <th>Legs</th>
                                <th>180s</th>
                                <th>140+</th>
                                <th>100+</th>
                                <th>High Finish</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.event_performances.map(perf => `
                                <tr>
                                    <td><strong>${perf.event_name}</strong></td>
                                    <td>${new Date(perf.event_date).toLocaleDateString()}</td>
                                    <td>${perf.average_score || 'N/A'}</td>
                                    <td>${perf.legs_played || 0}</td>
                                    <td>${perf.total_180s || 0}</td>
                                    <td>${perf.total_140_plus || 0}</td>
                                    <td>${perf.total_100_plus || 0}</td>
                                    <td>${perf.highest_finish || 'N/A'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                ` : ''}
            `;
            
            container.innerHTML = profileHtml;
        }

        // Load series summary
        async function loadSeriesSummary() {
            const container = document.getElementById('seriesContainer');
            
            try {
                const response = await fetch(`${API_BASE}/series-summary`);
                const data = await response.json();

                renderSeriesSummary(data);
            } catch (error) {
                console.error('Error loading series summary:', error);
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Error loading series summary</h3>
                        <p>Please try again later</p>
                    </div>
                `;
            }
        }

        // Render series summary
        function renderSeriesSummary(data) {
            const container = document.getElementById('seriesContainer');
            
            const summaryHtml = `
                <div class="series-summary">
                    <div class="summary-card">
                        <div class="summary-number">${data.total_events || 0}</div>
                        <div class="summary-label">Total Events</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${data.completed_events || 0}</div>
                        <div class="summary-label">Completed Events</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${data.total_players || 0}</div>
                        <div class="summary-label">Total Players</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-number">${data.championship_qualified || 0}</div>
                        <div class="summary-label">Championship Qualified</div>
                    </div>
                </div>

                ${data.events && data.events.length > 0 ? `
                    <h3 style="margin: 20px 0;">üìÖ Series Events Progress</h3>
                    <div class="event-grid">
                        ${data.events.map(event => `
                            <div class="event-card ${event.status === 'completed' ? '' : 'opacity-50'}" 
                                 onclick="viewEventStats(${event.id}, '${event.name}')">
                                <h3>${event.name}</h3>
                                <div class="event-meta">
                                    <p>üìÖ ${new Date(event.date).toLocaleDateString()}</p>
                                    <p>üéØ Event #${event.event_number}</p>
                                    <p>üìä ${event.status === 'completed' ? '‚úÖ Completed' : '‚è≥ ' + event.status}</p>
                                    ${event.total_matches ? `<p>üèÅ ${event.total_matches} matches</p>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
            `;
            
            container.innerHTML = summaryHtml;
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial data for the active section
            loadEvents();
        });
    </script>
</body>
</html>